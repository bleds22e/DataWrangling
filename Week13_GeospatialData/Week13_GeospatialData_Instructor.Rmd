---
title: 'Week 12: Geospatial Data'
author: "Jeff Oliver"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Geospatial Data

## Introduction

### Setup

Geospatial data are data that have some connection to specific places or areas 
on Earth. To work with geospatial data in R, we usually need to install one or
more additional packages. The two most popular packages for geospatial data are 
terra and sf. In this lesson, we will only be working with terra, and you can 
find links for more information on terra and on sf at the bottom of the lesson. 
In order to use the terra package, we must first install the package with 
`install.packages()`:

```{r terra-install, eval = FALSE}
install.packages("terra")
```

And we load it into memory with the `library()` command:

```{r terra-load, echo = FALSE}
suppressPackageStartupMessages(library(terra))
```

```{r terra-load-print, eval = FALSE}
library(terra)
```

### Some Terms

Geospatial data generally come in one of two types: raster data or vector data. 

+ **Raster** data are gridded data. They generally look like images and have a 
fixed resolution. This means that as you zoom in on raster data, you eventually 
start seeing the grids. Like when you zoom in on a photograph and it becomes 
"pixelated" - we will see an example of this later. Raster data are usually 
quantitative measurements of some sort, such as temperature, precipitation, and
reflectance in certain light wavelengths.
+ **Vector**, or shape, data are defined by specific coordinates on the Earth's 
surface and do not, technically, have a fixed resolution. This means that as 
you zoom in on Vector data, it never becomes "pixelated". Vector data usually 
take the form of points (a single pair of coordinates), lines (two or more 
coordinate pairs connected in a sequence), or polygons (three or more 
coordinate pairs connected in a closed sequence).

+ Show zooming effect on both

### Today's Destination

Today we will work with both raster and vector data, loading it into R, doing
some exploratory visualization, and modifying the data. Ultimately, we are 
going to create a map of temperature data of southwestern North America, 
highlighting those areas that are desert biomes.

+ Add final image

## Geospatial Raster Data

### Reading and Visualizing Data

+ Read in the data (temperature)

```{r read-temperature-data}
temp <- rast("global_temperature.tif")
temp
```

(Explain console output)

+ Look at the data (console)
+ Plot the data

### Aside: The world is not flat, so why is my map?

+ Reproject the data

### Modifying data

+ Do data transformation (like converting C to F)?

### Cropping data

+ Why do we need to do this?
+ Defining an extent
+ Crop to southwest & recolor (YlOrBr is good for temperature)
> plot(temp_son, col = rev(hcl.colors(50, palette = "YlOrBr")))

## Geospatial Vector Data

### Adding Points

Hermosillo: 29.016, -110.926
Phoenix: 33.453, -111.947
Tucson: 32.233, -110.953

### Adding Areas (aka Polygons)

Categorize areas as desert with prec_raster < 250 (general definition), 
turn 0 values to NA, and then convert to polygons with terra::as.polygons
Add this to plot to outline desert areas

### Other Resources

+ sf package
+ rspatial (terra et al.)
+ osmdata for OpenStreetMaps access
+ ggplot2 for geospatial?
+ Data Carpentry